syntax = "proto3";

option go_package = "go/user";

package user;

service user {
  rpc Create(CreateRequest) returns (CreateResponse) {}
  rpc Update(User) returns (UpdateResponse) {}
  rpc Get(GetRequest) returns (GetResponse) {}
  rpc GetByToken(GetByTokenRequest) returns (GetResponse) {}
  rpc GetList(GetListRequest) returns (GetListResponse) {}
  rpc Delete(DeleteRequest) returns (DeleteResponse) {}
  // @TODO: оставить отдельными методами? Или оставить в Update?
//  rpc Block(BlockRequest) returns (BlockResponse) {}
//  rpc Unblock(UnblockRequest) returns (UnblockResponse) {}
}

// CreateRequest
message CreateRequest {
  string username = 1;
  string password = 2;
  // основные поля
  string phone = 3;
  string email = 4;
  string first_name = 5;
  string middle_name = 6;
  string last_name = 7;
  string birthdate = 8;
  string gender = 9;
  string create_source = 10;
  // клиентские поля
  int32  store_code = 11;
  int32  rcrm_id = 12;
  string clothing_size = 13;
  string shoe_size = 14;
  string country = 15;
  string city = 16;
  string region = 17;
  bool   is_vic = 18;
  bool   is_personal_policy_accepted = 19;
  // поля внутренних пользователей
  string department = 20;
  string position = 21;
  int64  site_id = 22;
  string onec_id = 23;
  string wms_id = 24;
}

message CreateResponse {
  string            status = 1;
  string            message = 2;
  int64             code = 3;
  repeated Error    errors = 4;
  User              data = 5;
}

// User
message User {
  string id = 1;
  optional string username = 2;
  optional string password = 3;
  // основные поля
  optional string phone = 4;
  optional string email = 5;
  optional string first_name = 6;
  optional string middle_name = 7;
  optional string last_name = 8;
  optional string birthdate = 9;
  optional string gender = 10;
  optional string create_source = 11;
  // клиентские поля
  optional int32  store_code = 12;
  optional int32  rcrm_id = 13;
  optional string clothing_size = 14;
  optional string shoe_size = 15;
  optional string country = 16;
  optional string city = 17;
  optional string region = 18;
  optional bool   is_vic = 19;
  optional bool   is_personal_policy_accepted = 20;
  // поля внутренних пользователей
  optional string department = 21;
  optional string position = 22;
  optional int64  site_id = 23;
  optional string onec_id = 24;
  optional string wms_id = 25;
}

message UpdateResponse {
  string            status = 1;
  string            message = 2;
  int64             code = 3;
  repeated Error    errors = 4;
  User              data = 5;
}

// Get
message GetRequest {
  string id = 1;
}

message GetResponse {
  string            status = 1;
  string            message = 2;
  int64             code = 3;
  repeated Error    errors = 4;
  User              data = 5;
}

// GetByToken
message GetByTokenRequest {
  string access_token = 1;
}

// GetList
message GetListRequest {
  GetListFilters filters = 1;
  Pagination     pagination = 2;
}

message GetListResponse {
  string            status = 1;
  string            message = 2;
  int64             code = 3;
  repeated Error    errors = 4;
  repeated User     data = 5;
}

// Delete
message DeleteRequest {
  string id = 1;
}

message DeleteResponse {
  string            status = 1;
  string            message = 2;
  int64             code = 3;
  repeated Error    errors = 4;
}

// Error
message Error {
  string target = 1;
  int64  code = 2;
  string message = 3;
}

enum UserType {
  CLIENT = 0;
  EMPLOYEE = 1;
}

// Filters
message GetListFilters {
  string   updated_from = 1;
  string   updated_to   = 2;
  UserType type         = 3;
}

// Pagination
message Pagination {
  int64 limit = 1;
  int64 offset = 2;
}